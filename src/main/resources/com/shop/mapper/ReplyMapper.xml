<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.shop.mapper.ReplyMapper">
 
 	<!-- 댓글 등록 -->
 	<insert id="enrollReply">
 		insert 
 		into	test_reply(reply_id, book_id, member_id, content, rating) 
 		values	(test_SEQ.nextval, #{book_id}, #{member_id}, #{content}, #{rating})
 	</insert>
 	
 	
 	<!-- 댓글 존재 체크 -->
 	<select id="checkReply" resultType="Integer">
 		select 	reply_id 
 		from	test_reply 
 		where	member_id=#{member_id} AND book_id=#{book_id}
 	</select>
 	
 	
	<!-- 댓글 페이징 -->
  	<select id="getReplyList" resultType="com.shop.model.ReplyDTO">
  	
  		<![CDATA[
		SELECT * FROM
		(  		
			select 	rownum as rn, reply_id, book_id, member_id, content, rating, regDate
			from 	test_reply
			where 	rownum <= #{pageNum} * #{amount}  and bookId = #{bookId}	
			order by regDate desc  	
  		)
  		WHERE rn > (#{pageNum} -1) * #{amount}
  		]]>	
  		
  	</select>
  	
  	
  	<!-- 댓글 총 갯수 -->
  	<select id="getReplyTotal" resultType="int">
  		SELECT 	count(*)
  		FROM 	test_reply
  		WHERE 	book_id = #{book_id}
  	</select>
 	
 	
 	
 	
 	
 	
 	
 	
  </mapper>